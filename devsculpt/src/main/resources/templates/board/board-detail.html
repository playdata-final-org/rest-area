<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">

<head>
    <meta charset="UTF-8">
    <title>Devsculpt</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" />
    <link href="/assets/css/boarddetail.css" rel="stylesheet" type="text/css"/>
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
</head>

<body>
<div th:replace="layout/header"></div>

<div class="container">
    <!-- 수정: 작성자 정보와 수정하기 삭제하기 버튼 통합 -->
    <div class="author-section" style="display: flex; justify-content: space-between; align-items: center;">
        <p class="user-menu">
            <img th:if="${board.profileImage != null}" th:src="'/upload/' + ${board.profileImage}"
                 class="rounded-circle" width="30" height="30" alt="프로필 이미지"/>
            <img th:unless="${board.profileImage != null}" th:src="@{/assets/image/defaultprofile.png}"
                 class="rounded-circle" width="30" height="30" alt="기본 프로필 이미지"/>
            <span th:text="${board.nickName}" class="author-name"></span>
        </p>
        <div class="edit-buttons">
            <!-- 수정: 수정하기 버튼에 링크 추가 -->
            <a th:href="@{'/dev/board/' + ${boardId} + '/update'}" class="btn btn-primary">수정하기</a>
            <!-- 수정: 삭제하기 버튼에 onclick 이벤트 추가 -->
            <button type="button" class="btn btn-danger" onclick="confirmDelete('${boardId}')">삭제하기</button>
        </div>
    </div>

    <div class="content-section">
        <div class="board-title">
            <div th:utext="${board.title}" class="board-title">게시글제목</div>
        </div>
        <div th:utext="${board.content}" class="board-content">본문</div>
    </div>

    <!-- 댓글 입력 폼 -->
    <div class="comment-form-container">
        <div class="comment-form">
            <form th:action="@{'/dev/board/' + ${board.boardId} + '/comment'}" method="post">
                <div>
                    <textarea id="content" name="content" required placeholder="여러분의 창의적인 아이디어로 댓글을 남겨주세요."></textarea>
                </div>
                <button type="submit" class="btn btn-success">댓글 등록</button>
            </form>
        </div>
    </div>

    <!-- 댓글 리스트 -->
    <div class="comment-list">
        <h3>댓글</h3>
        <ul th:each="comment : ${comments}">
            <li>
                <!-- 수정: 댓글에 대한 프로필 이미지 및 닉네임 표시 -->
                <img th:if="${comment.profileImage != null}" th:src="'/upload/' + ${comment.profileImage}" alt="프로필 이미지" class="rounded-circle" width="30" height="30" />
                <img th:unless="${comment.profileImage != null}" th:src="@{/assets/image/defaultprofile.png}" alt="기본 프로필 이미지" class="rounded-circle" width="30" height="30" />
                <span th:text="${comment.nickName}"></span> :
                <span th:text="${comment.content}"></span>
            </li>
        </ul>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<!-- 수정: JavaScript 코드 추가 -->
<script>
    function confirmDelete(boardId) {
      // 삭제하기 전에 사용자에게 확인을 받는다
      var isConfirmed = confirm("정말 삭제하시겠습니까?");

      // 사용자가 확인을 선택했을 때
      if (isConfirmed) {
          // AJAX를 이용한 삭제 요청
          $.ajax({
              type: "DELETE",
              url: '/dev/board/' + [[${boardId}]],
              success: function (data) {
                  // 삭제 성공 시 실행되는 코드
                  alert("게시글이 삭제되었습니다.");
                  window.location.href = '/dev/index';
              },
              error: function (error) {
                  // 삭제 실패 시 실행되는 코드
                  console.error("Error deleting board:", error);
                  alert("게시글 삭제에 실패했습니다.");
              }
          });
      }
  }
</script>
</body>

</html>
